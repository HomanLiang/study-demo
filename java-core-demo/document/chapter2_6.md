[toc]



# 字符编码

## 1.编码介绍及历史

我们都知道计算机只能理解二进制数据暨 `0` 和 `1`，二进制是计算机语言，这是因为计算机在设计之初是由八个晶体管通过开合来表示数据的，于是这八位二进制数据被称为“字节”，一个字节根据八位的不同组合共有 `256` 种不同的结果。

在计算机启用之初，由于只在美国本土使用，所以开发者通过 `256` 个编码制定了 `ASCII` 标准，`ASCII` 是将二进制字符对应到大小写字母、数字和常用符号的映射关系表，表如下：

![img](https://homan-blog.oss-cn-beijing.aliyuncs.com/study-demo/java-core-demo/20210505133157.png)

我们可以看到，这张表里只用到了 `128` 就能完整表示出所有英语文字的方案了，而 `128-255` 位被定义为了扩展字符集，留作日后用来扩展使用，例如用来表示如：边框、圆角、西文等字符，以下是第一批 `IBM` 计算机使用的 `ASCII` 的 `128-255` 编码映射关系。

![img](https://homan-blog.oss-cn-beijing.aliyuncs.com/study-demo/java-core-demo/20210505133206.png)

但随着计算机的不断普及，国内和其他的一些国家也开始使用电脑，为了能在计算机上使用自己的文字， 很多国家选择在 `127-255` 扩展定义自己的文字。

我们国内也一样扩展了自己的映射表，但我们的常用汉字数量还是远远大于这个阈值的储存能力，于是我们定义在中文字符编码格式下，两个字节表示一个汉字。于是在当时各个国家都有自己一套独特的扩展编码标准，以至于导致计算机在当时显示不同国家的字符时经常会出现乱码。

类似下面这样

![img](https://homan-blog.oss-cn-beijing.aliyuncs.com/study-demo/java-core-demo/20210505133216.png)

## 2.Unicode的统一

互联网是将世界各地计算机连接起来的途径，如果能通过一套标准为每种语言中的每个字符都设定统一且唯一对应的编码，那么世界上所有的文字都能正常显示出来，而不用为了显示某种文字而频繁切换 `codepage`。

���当然���如果就是���想显示֎֏0590成这样׃ׅׄ׆ׇ除外֐��。

于是ISO国际组织于1994年正式推出了 `Unicode` 标准（又称万国码、统一码）。之所以能统一，是因为 `Unicode` 规定了，所有字符统一由两个字节来表示，也就是 `16` 位。原先的英文字符、数字和半角符号虽然原先在 `ASCII` 中只用 `8` 位就能表现，但需要扩充为 `16` 位的话必须在高位补 `0`， 如下示例：

`1 – 00000001 – 00000000 00000001`

可以看到，通过增长位数来扩展支持更多的语种这样的方式很不错，但在纯英文环境下由于没有用的补零高位会导致文本占用大量的存储空间，而这一情况在互联网时代的到来变得更加明显。

于是为了解决英文 `Unicode` 在网络传输时带来的低效问题，`UTF` 协议也随之而来。

## 3.Unicode 转换协议 (UTF)

`UTF` 是我们对 `Unicode` 码点进行编码的一种方式。`UTF` 编码是由 `Unicode` 标准定义的，能够对我们需要的每一个 `Unicode` 码点进行编码。

但是 `UTF` 标准有不同的类型。它们分为 `UTF-8`、`UTF-16` 和 `UTF-32` ，而其中在互联网中最常用的就是 `UTF-8`，在 `HTML5` 中也被置顶位新文档的默认编码。

下图中你可以看到，从 `2012` 年开始，`UTF-8` 相较其他字符集的受欢迎度越来越高。

![img](https://homan-blog.oss-cn-beijing.aliyuncs.com/study-demo/java-core-demo/20210505133228.png)

 ![img](https://homan-blog.oss-cn-beijing.aliyuncs.com/study-demo/java-core-demo/20210505133238.png)

## 4.什么是UTF-8，它的工作原理是什么？

`UTF-8` 是一种可变长的编码方式，理论上可达 `6` 个字节，但已现行文字和符号看，`4` 个字节是已经足够了。

`UTF-8` 以 `8` 位（即 1个字节）为单元对原始 `Unicode` 码进行编码，规定：多字节码（`2` 个字节以上）以转换后第 `1` 个字节起头的连续“1”的数目（这些连续“1”称为标记位），表示转换成几个字节：“110”连续两个“1”，表示转换结果为2个字节，“1110”表示3个字节，而“11110”则表示4个字节……跟随在标记位之后的“0”，其作用是分隔标记位和字符码位。第2～第4个字节的起头两个位固定设置为“10”，也作为标记，剩下的6个位才做为字符码位使用。这样，2字节 `UTF-8` 码剩下11个字符码位，可用以转换 `0080～07FF` 的原始字符码，3字节剩下16个字符码位，可用以转换 `0800～FFFF` 的原始字符码，由此类推。编码方式的模板如下：

```
Unicode符号范围(十六进制)  |   UTF-8编码方式（二进制）
—————————————————————–
0000 0000-0000 007F | 0xxxxxxx
0000 0080-0000 07FF | 110xxxxx 10xxxxxx
0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
```

编码使用的位数取决于语言，一般来讲，英文会被编码为1个字节，欧洲（拉丁），希伯来语和阿拉伯语用2个字节表示。中文，日文，韩文和其他亚洲字符使用3个字节。你可能发现了，原本为了解决占用过长的问题，但实际编码后中文长度变为了3字节，如果你的客户都是国内用户，使用 `GBK` 能部分提高网页内文本的传输效率。

## 5.编码声明方式

看起来正确声明编码类型很重要，那么，我们该如何指定编码呢？

只需在 `<head>` 中的 `meta` 声明使用的字符集即可，如下：

```
<html lang="en">
<head>
  <meta charset="utf-8">
</head>
```

除了以上方式外，我们还可以从 `HTTP` 请求/响应的 `Content-Type` 表头中声明。